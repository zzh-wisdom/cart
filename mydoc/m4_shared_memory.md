# Shared-memory plugin for Mercury

<https://mercury-hpc.github.io/documentation/2018/10/29/shared-memory.html>

Mercury定义了一个网络抽象层，该层允许定义高速网络的插件。在**节点内**通信的情况下，在进程之间访问内存的最有效方法是使用共享内存。

## Introduction

Mercury的网络抽象层旨在通过提供两种类型的消息传递来利用高速网络：**小消息传递（低延迟）**和**大传输（高带宽）**。小消息分为两类：**非预期消息**和**预期消息**。大型传输使用单面机制来高效访问远程内存，从而无需中间副本即可进行传输。该接口当前提供BMI，MPI，CCI和OFI libfabric的实现，它们本身是常见HPC网络协议之上的抽象。**当在单独的进程之间的同一节点上本地进行通信时，希望绕过环回网络接口并直接访问/共享内存区域，从而增加带宽并减少传输的延迟**。尽管CCI插件已经提供了共享的内存传输，但是它目前具有一些固有的局限性：处理是显式的，对用户不透明；它要求显式使用CCI外部库；它在内部使用连接线程； CCI仅提供每个连续段区域的RMA注册，从而防止用户在一个RMA操作中转移非连续区域。

还值得注意的是，其他库（例如libfabric）也支持共享内存优化，尽管它具有一个独立的共享内存插件，该插件可以透明方式同时与其他传输一起使用（并且可以提供最佳性能），这是mercury的重要特征。

## Requirements

该插件的设计遵循三个主要要求：

- 尽可能重用现有的共享内存技术和概念；
- 同时在常规和共享内存通信方面取得进展，而无需忙于等待；
- **透明**地使用插件（即可以在常规和共享内存通信中使用相同的地址）。

## SM Plugin Architecture

该插件可以分解为多个部分：查找，短消息（意外和预期的）； 
RMA转移；进度。进程之间的交换通道的查找，连接和设置是通过UNIX域套接字初始化的。在侦听进程上创建一个侦听套接字，然后以非阻塞方式接受连接并在对等方之间交换地址通道信息。

(...)